apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: default

resources:
  - ../../base/identity-service
  - ../../base/user-service
  - ../../base/blog-service
  - ../../base/frontend

# Production images from ECR (GitOps Coordinator updates these)
# IMPORTANT: Only GitOps Coordinator modifies these tags
images:
  - name: identity-service
    newName: 939217651725.dkr.ecr.eu-west-2.amazonaws.com/kubeadm_ec2_cluster/identity-service
    newTag: v1.0.0
  - name: user-service
    newName: 939217651725.dkr.ecr.eu-west-2.amazonaws.com/kubeadm_ec2_cluster/user-service
    newTag: v1.0.0
  - name: blog-service
    newName: 939217651725.dkr.ecr.eu-west-2.amazonaws.com/kubeadm_ec2_cluster/blog-service
    newTag: v1.0.0
  - name: frontend
    newName: 939217651725.dkr.ecr.eu-west-2.amazonaws.com/kubeadm_ec2_cluster/frontend
    newTag: v1.0.0

# Production patches
patches:
  - path: patches/replicas-ha.yaml
  - path: patches/resources-prod.yaml

# ConfigMap for production rules
configMapGenerator:
  - name: platform-rules
    files:
      - rules.json
    options:
      disableNameSuffixHash: true

commonLabels:
  environment: prod
